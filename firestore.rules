rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ---- Admin definition (Email/Password Auth -> token.email) ----
    function isAdmin() {
      return request.auth != null
        && request.auth.token.email == "groberts3104@gmail.com";
    }

    // ---- Site config docs (readable by everyone, writable by admin) ----
    // Navbar visibility cloud doc:
    //   collection: rv_config
    //   doc: navVisibility
    match /rv_config/{docId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // Home visibility cloud doc:
    //   collection: rv_siteSettings
    //   doc: homeVisibility
    match /rv_siteSettings/{docId} {
      allow read: if true;
      allow write: if isAdmin();
    }

    // ---- Requests cloud backup (admin-only for now) ----
    // These are sensitive because they contain customer info (name/phone/address/photos).
    // Your app treats cloud saves as "best effort", so blocking writes won't break the app.
    match /rv_requests/{docId} {
      allow read, write: if isAdmin();
    }

    match /rv_requestIndex/{docId} {
      allow read, write: if isAdmin();
    }

    // ---- Default deny (everything else) ----
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
